<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bosch GS/OSD-APAC Supply Chain Control Tower</title>
    
    <!-- 1. Ê†∑ÂºèÂ∫ì: Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Ê†∏ÂøÉÂ∫ì: React 17 & ReactDOM 17 (ÊúÄÁ®≥ÂÆöÁâàÊú¨) -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    
    <!-- 3. ÂõæË°®Â∫ì: Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- 4. ÁºñËØëÂô®: Babel (ËÆ©ÊµèËßàÂô®ËÉΩÁúãÊáÇ React ‰ª£Á†Å) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Â≠ó‰Ωì‰∏éÂä®ÁîªÊ†∑Âºè -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        
        /* Ëá™ÂÆö‰πâÊªöÂä®Êù° */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        
        /* Âä®ÁîªÁ±ª */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .pulse-dot {
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        // ‰ªéÂÖ®Â±ÄÂèòÈáè Recharts ‰∏≠Ëß£ÊûÑÁªÑ‰ª∂
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
            PieChart, Pie, Cell, Sector 
        } = window.Recharts;

        // --- 0. ÂõæÊ†áÁªÑ‰ª∂ (SVG) ---
        // ‰ΩøÁî®Á∫Ø SVG ÈÅøÂÖç‰æùËµñÂ∫ìÂä†ËΩΩÈóÆÈ¢ò
        const Icon = ({ d, className, color }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ color }}>
                {d}
            </svg>
        );

        const Icons = {
            Menu: (p) => <Icon {...p} d={<path d="M4 6h16M4 12h16M4 18h16"/>} />,
            X: (p) => <Icon {...p} d={<path d="M18 6L6 18M6 6l12 12"/>} />,
            Search: (p) => <Icon {...p} d={<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>} />,
            Filter: (p) => <Icon {...p} d={<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>} />,
            Truck: (p) => <Icon {...p} d={<rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/>} />,
            Package: (p) => <Icon {...p} d={<line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>} />,
            Bot: (p) => <Icon {...p} d={<rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/>} />,
            Send: (p) => <Icon {...p} d={<line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>} />,
            Alert: (p) => <Icon {...p} d={<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>} />,
            TrendingUp: (p) => <Icon {...p} d={<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>} />,
            Key: (p) => <Icon {...p} d={<path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>} />
        };

        // --- 1. Êï∞ÊçÆÊ∫ê (Case 2 Data) ---
        const RAW_DATA = [
            { warehouse: "CN004", gb: "AA", country: "CN", inbound: 77, outbound: 41 },
            { warehouse: "CN005", gb: "PT", country: "CN", inbound: 25971, outbound: 5741 },
            { warehouse: "CN023", gb: "AA", country: "CN", inbound: 74, outbound: 8 },
            { warehouse: "CN025", gb: "PT", country: "CN", inbound: 1998, outbound: 819 },
            { warehouse: "CN034", gb: "PT", country: "CN", inbound: 2855, outbound: 1307 },
            { warehouse: "CN305", gb: "PT", country: "CN", inbound: 5152, outbound: 1825 },
            { warehouse: "HK001", gb: "PT", country: "CN", inbound: 1170, outbound: 215 },
            { warehouse: "JP043", gb: "AA", country: "JP", inbound: 95829, outbound: 15525 },
            { warehouse: "JP044", gb: "PT", country: "JP", inbound: 62582, outbound: 2056 },
            { warehouse: "KR001", gb: "PT", country: "KR", inbound: 30043, outbound: 2282 },
            { warehouse: "TW001", gb: "AA", country: "TW", inbound: 2255, outbound: 1504 },
            { warehouse: "TW002", gb: "PT", country: "TW", inbound: 5250, outbound: 1747 },
            { warehouse: "CN072", gb: "AA", country: "CN", inbound: 656, outbound: 27 },
            { warehouse: "CN200", gb: "AA", country: "CN", inbound: 173, outbound: 15 }
        ];

        const COLORS = ['#005691', '#008ECF', '#E20015', '#FFD200', '#525F6B']; // Bosch Brand Colors

        // --- 2. AI È¢ÑËÆæÂõûÂ§ç (Ê®°ÊãüÂêéÁ´Ø) ---
        const AI_RESPONSES = {
            "default": "ÊàëÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÂàÜÊûê Case 2 ÁöÑÊï∞ÊçÆ„ÄÇÊÇ®ÂèØ‰ª•ÈóÆÊàëÂÖ≥‰∫é‚ÄúÊó•Êú¨Â∫ìÂ≠òÈ£éÈô©‚Äù„ÄÅ‚Äú‰∏öÂä°ÈÉ®Âç†ÊØî‚ÄùÊàñ‚ÄúÊúÄÁπÅÂøôÁöÑ‰ªìÂ∫ì‚ÄùÁ≠âÈóÆÈ¢ò„ÄÇ",
            "risk": "Ê†πÊçÆÊï∞ÊçÆÂàÜÊûêÔºå**Êó•Êú¨ (JP)** Â∏ÇÂú∫Â≠òÂú®ÊòæËëóÁöÑÂ∫ìÂ≠òÁßØÂéãÈ£éÈô©„ÄÇ\n\n- **JP043 (AA)** ÂÖ•Â∫ìÈáè 9.5‰∏áÔºåÂá∫Â∫ì‰ªÖ 1.5‰∏á (ÊØîÁéá 6.1:1)„ÄÇ\n- **JP044 (PT)** ÂÖ•Â∫ìÈáè 6.2‰∏áÔºåÂá∫Â∫ì‰ªÖ 2ÂçÉ (ÊØîÁéá 30:1)„ÄÇ\n\nÂª∫ËÆÆÁ´ãÂç≥Ê£ÄÊü•Êó•Êú¨‰ªìÂ∫ìÁöÑÂ∫ìÂÆπÂà©Áî®ÁéáÔºåÂπ∂ÊöÇÁºìÈùûÁ¥ßÊÄ•Ë°•Ë¥ß„ÄÇ",
            "busy": "Êï∞ÊçÆÊòæÁ§∫ÔºåÊúÄÁπÅÂøôÁöÑ‰ªìÂ∫ìÔºàÊåâÊÄªÂêûÂêêÈáèÔºâÂâç‰∏âÂêçÂùá‰∏∫Êó•Êú¨ÂíåÈü©ÂõΩ‰ªìÂ∫ìÔºö\n1. **JP043** (AA): ÊÄªËÆ° 111,354 ËÆ¢ÂçïË°å\n2. **JP044** (PT): ÊÄªËÆ° 64,638 ËÆ¢ÂçïË°å\n3. **KR001** (PT): ÊÄªËÆ° 32,325 ËÆ¢ÂçïË°å",
            "ratio": "AA Âíå PT ‰∏öÂä°ÈÉ®ÁöÑÂØπÊØîÂ¶Ç‰∏ãÔºö\n- **PT** Ë¥°ÁåÆ‰∫ÜÁ∫¶ 65% ÁöÑÂÖ•Â∫ìÈáèÔºå‰∏ªË¶ÅÈõÜ‰∏≠Âú® CN Âíå KR„ÄÇ\n- **AA** Ë¥°ÁåÆ‰∫ÜÁ∫¶ 35% ÁöÑÂÖ•Â∫ìÈáèÔºå‰ΩÜÂÖ∂Âú®Êó•Êú¨Â∏ÇÂú∫ÁöÑÂá∫Â∫ìÊ¥ªÂä®Êõ¥Ê¥ªË∑É„ÄÇ\n\nPT ‰∏öÂä°ÂëàÁé∞Âá∫ÂÖ∏ÂûãÁöÑ‚ÄúÂ§ßÊâπÈáè„ÄÅ‰ΩéÈ¢ëÊ¨°‚ÄùÁâπÂæÅÔºåËÄå AA ‰∏öÂä°ÊµÅËΩ¨ÈÄüÂ∫¶Á®çÂø´„ÄÇ"
        };

        const QUICK_ACTIONS = [
            { text: "üáØüáµ ÂàÜÊûêÊó•Êú¨Â∫ìÂ≠òÈ£éÈô©", key: "risk" },
            { text: "üèÜ ÊúÄÁπÅÂøô‰ªìÂ∫ìÊéíÂêç", key: "busy" },
            { text: "üìä AA vs PT ‰∏öÂä°ÂØπÊØî", key: "ratio" }
        ];

        // --- 3. ‰∏ªÂ∫îÁî®ÁªÑ‰ª∂ ---
        const App = () => {
            // Áä∂ÊÄÅÁÆ°ÁêÜ
            const [filterGb, setFilterGb] = useState('All'); // ÂàáÁâáÂô®Áä∂ÊÄÅ
            const [searchTerm, setSearchTerm] = useState('');
            const [showAiPanel, setShowAiPanel] = useState(false);
            const [messages, setMessages] = useState([{ role: 'ai', content: AI_RESPONSES['default'] }]);
            const [inputVal, setInputVal] = useState('');
            const [apiKey, setApiKey] = useState('');
            const [showKeyInput, setShowKeyInput] = useState(false);
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };
            useEffect(scrollToBottom, [messages, isTyping]);

            // Êï∞ÊçÆÂ§ÑÁêÜÈÄªËæë (useMemo ÁºìÂ≠òËÆ°ÁÆóÁªìÊûú)
            const processedData = useMemo(() => {
                let data = RAW_DATA;
                
                // 1. ÂàáÁâáÂô®ËøáÊª§
                if (filterGb !== 'All') {
                    data = data.filter(d => d.gb === filterGb);
                }
                
                // 2. ÊêúÁ¥¢ËøáÊª§
                if (searchTerm) {
                    const lower = searchTerm.toLowerCase();
                    data = data.filter(d => 
                        d.warehouse.toLowerCase().includes(lower) || 
                        d.country.toLowerCase().includes(lower)
                    );
                }
                
                return data;
            }, [filterGb, searchTerm]);

            // ËÅöÂêàÊï∞ÊçÆÔºöÊåâÂõΩÂÆ∂
            const countryStats = useMemo(() => {
                const map = {};
                processedData.forEach(d => {
                    if (!map[d.country]) map[d.country] = { country: d.country, inbound: 0, outbound: 0 };
                    map[d.country].inbound += d.inbound;
                    map[d.country].outbound += d.outbound;
                });
                return Object.values(map).sort((a, b) => b.inbound - a.inbound);
            }, [processedData]);

            // ËÅöÂêàÊï∞ÊçÆÔºöÊåâ‰∏öÂä°ÈÉ® (ÁéØÂΩ¢ÂõæÁî®)
            const gbStats = useMemo(() => {
                const map = { 'AA': 0, 'PT': 0 };
                RAW_DATA.forEach(d => map[d.gb] += (d.inbound + d.outbound)); // ÂßãÁªàÊòæÁ§∫ÂÖ®Â±ÄÊØî‰æã
                return Object.keys(map).map(k => ({ name: k, value: map[k] }));
            }, []);

            // ÊÄªËÆ°
            const totals = useMemo(() => {
                return processedData.reduce((acc, cur) => ({
                    in: acc.in + cur.inbound,
                    out: acc.out + cur.outbound
                }), { in: 0, out: 0 });
            }, [processedData]);

            // ÂèëÈÄÅÊ∂àÊÅØÈÄªËæë
            const handleSend = async (overrideText = null, overrideKey = null) => {
                const text = overrideText || inputVal;
                if (!text.trim()) return;

                // Áî®Êà∑Ê∂àÊÅØ‰∏äÂ±è
                setMessages(prev => [...prev, { role: 'user', content: text }]);
                setInputVal('');
                setIsTyping(true);

                // Ê®°Êãü AI ÊÄùËÄÉÂª∂Ëøü
                setTimeout(async () => {
                    let reply = "";
                    
                    // 1. ‰ºòÂÖàÊ£ÄÊü•ÊòØÂê¶ÊúâÈ¢ÑËÆæ Key (Ê®°ÊãüÊ®°Âºè)
                    if (overrideKey && AI_RESPONSES[overrideKey]) {
                        reply = AI_RESPONSES[overrideKey];
                    } 
                    // 2. Â¶ÇÊûúÂ°´‰∫Ü API KeyÔºåÂàôËØ∑Ê±Ç Gemini (ÁúüÂÆûÊ®°Âºè)
                    else if (apiKey) {
                        try {
                            const sysPrompt = `You are a Supply Chain Analyst for Bosch. Data context: Total Inbound ${totals.in}, Total Outbound ${totals.out}. Top Country: ${countryStats[0]?.country}. Answer in Chinese.`;
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    contents: [{ parts: [{ text: text }] }],
                                    systemInstruction: { parts: [{ text: sysPrompt }] }
                                })
                            });
                            const resData = await response.json();
                            reply = resData.candidates?.[0]?.content?.parts?.[0]?.text || "API ËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü• Key„ÄÇ";
                        } catch (e) {
                            reply = "ÁΩëÁªúËøûÊé•ÈîôËØØ„ÄÇ";
                        }
                    } 
                    // 3. ÈªòËÆ§ÂõûÂ§ç
                    else {
                        reply = "ÔºàÊºîÁ§∫Ê®°ÂºèÔºâËøôÊòØ‰∏Ä‰∏™Ê®°ÊãüÂõûÂ§ç„ÄÇÂ¶ÇÊûúÊÇ®ÈúÄË¶ÅÁúüÂÆû AI ÂàÜÊûêÔºåËØ∑ÁÇπÂáªÂè≥‰∏äËßíËÆæÁΩÆ API KeyÔºåÊàñËÄÖÁÇπÂáª‰∏äÊñπÁöÑÂø´Êç∑Êåá‰ª§Âç°ÁâáÊü•ÁúãÈ¢ÑËÆæÂâßÊú¨„ÄÇ";
                    }

                    setMessages(prev => [...prev, { role: 'ai', content: reply }]);
                    setIsTyping(false);
                }, 800);
            };

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    {/* --- È°∂ÈÉ®ÂØºËà™Ê†è --- */}
                    <header className="bg-slate-900 text-white shadow-lg z-20 shrink-0">
                        <div className="px-6 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-[#005691] p-2 rounded-lg">
                                    <Icons.Truck className="w-6 h-6 text-white" />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold tracking-tight">Bosch GS/OSD-APAC</h1>
                                    <p className="text-xs text-slate-400">Supply Chain Control Tower (Case 2)</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                {/* ÂàáÁâáÂô® (Slicer) */}
                                <div className="hidden md:flex bg-slate-800 rounded-full p-1 border border-slate-700">
                                    {['All', 'AA', 'PT'].map(gb => (
                                        <button
                                            key={gb}
                                            onClick={() => setFilterGb(gb)}
                                            className={`px-4 py-1.5 rounded-full text-xs font-medium transition-all ${
                                                filterGb === gb 
                                                ? 'bg-[#005691] text-white shadow' 
                                                : 'text-slate-400 hover:text-white'
                                            }`}
                                        >
                                            {gb === 'All' ? 'ÂÖ®ÈÉ®‰∏öÂä°' : `${gb} BU`}
                                        </button>
                                    ))}
                                </div>

                                {/* API Key ËÆæÁΩÆ */}
                                <div className="relative">
                                    <button onClick={() => setShowKeyInput(!showKeyInput)} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition">
                                        <Icons.Key className="w-5 h-5" />
                                    </button>
                                    {showKeyInput && (
                                        <div className="absolute right-0 top-12 w-64 bg-white p-4 rounded-xl shadow-xl border border-slate-200 text-slate-800 z-50 fade-in">
                                            <p className="text-xs font-bold mb-2 text-slate-500">Google Gemini API Key</p>
                                            <input 
                                                type="password" 
                                                value={apiKey} 
                                                onChange={e => setApiKey(e.target.value)}
                                                placeholder="Á≤òË¥¥ Key ‰ª•ÂêØÁî®ÁúüÂÆû AI..."
                                                className="w-full border rounded px-2 py-1.5 text-xs mb-2 focus:ring-2 focus:ring-[#005691] outline-none"
                                            />
                                            <button onClick={() => setShowKeyInput(false)} className="w-full bg-[#005691] text-white py-1 rounded text-xs">‰øùÂ≠ò</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                        
                        {/* ÁßªÂä®Á´ØÂàáÁâáÂô® */}
                        <div className="md:hidden px-4 pb-3 flex gap-2 overflow-x-auto">
                             {['All', 'AA', 'PT'].map(gb => (
                                <button
                                    key={gb}
                                    onClick={() => setFilterGb(gb)}
                                    className={`px-3 py-1 rounded-full text-xs font-medium border ${
                                        filterGb === gb 
                                        ? 'bg-[#005691] border-[#005691] text-white' 
                                        : 'border-slate-700 text-slate-400'
                                    }`}
                                >
                                    {gb}
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* --- ‰∏ªÂÜÖÂÆπÂå∫ --- */}
                    <div className="flex flex-1 overflow-hidden relative">
                        {/* Â∑¶‰æßÔºöÊï∞ÊçÆ‰ª™Ë°®Áõò */}
                        <main className="flex-1 overflow-y-auto p-4 md:p-6 custom-scroll">
                            <div className="max-w-7xl mx-auto space-y-6">
                                
                                {/* 1. Ê†∏ÂøÉÊåáÊ†áÂç°Áâá (KPI Cards) */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-center justify-between">
                                        <div>
                                            <p className="text-xs text-slate-500 font-medium uppercase">Total Inbound</p>
                                            <p className="text-2xl font-bold text-[#005691]">{totals.in.toLocaleString()}</p>
                                        </div>
                                        <div className="bg-blue-50 p-3 rounded-full text-[#005691]"><Icons.Truck className="w-6 h-6" /></div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-center justify-between">
                                        <div>
                                            <p className="text-xs text-slate-500 font-medium uppercase">Total Outbound</p>
                                            <p className="text-2xl font-bold text-[#E20015]">{totals.out.toLocaleString()}</p>
                                        </div>
                                        <div className="bg-red-50 p-3 rounded-full text-[#E20015]"><Icons.Package className="w-6 h-6" /></div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-center justify-between">
                                        <div>
                                            <p className="text-xs text-slate-500 font-medium uppercase">In/Out Balance</p>
                                            <p className="text-2xl font-bold text-slate-700">{(totals.in / (totals.out || 1)).toFixed(1)}x</p>
                                        </div>
                                        <div className="bg-amber-50 p-3 rounded-full text-amber-600"><Icons.Activity className="w-6 h-6" /></div>
                                    </div>
                                </div>

                                {/* 2. ÂõæË°®Âå∫ (Charts) */}
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    {/* Â∑¶‰æßÔºöÁ∞áÁä∂Êü±ÂΩ¢Âõæ (Clustered Column Chart) */}
                                    <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                                <Icons.TrendingUp className="w-5 h-5 text-[#005691]" />
                                                Âå∫ÂüüËÆ¢ÂçïÈáèÂØπÊØî (Inbound vs Outbound)
                                            </h3>
                                        </div>
                                        <div className="h-[300px] w-full">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <BarChart data={countryStats} margin={{top: 10, right: 10, left: -10, bottom: 0}}>
                                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                    <XAxis dataKey="country" axisLine={false} tickLine={false} tick={{fill:'#64748b', fontSize:12}} />
                                                    <YAxis axisLine={false} tickLine={false} tick={{fill:'#64748b', fontSize:12}} />
                                                    <Tooltip 
                                                        contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} 
                                                        cursor={{fill: '#f8fafc'}}
                                                    />
                                                    <Legend wrapperStyle={{paddingTop:'10px'}} />
                                                    <Bar name="ÂÖ•Â∫ì (In)" dataKey="inbound" fill="#005691" radius={[4,4,0,0]} barSize={20} />
                                                    <Bar name="Âá∫Â∫ì (Out)" dataKey="outbound" fill="#E20015" radius={[4,4,0,0]} barSize={20} />
                                                </BarChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>

                                    {/* Âè≥‰æßÔºöÁéØÂΩ¢Âõæ (Donut Chart) */}
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                        <h3 className="font-bold text-slate-700 mb-2">‰∏öÂä°ÈÉ®Âç†ÊØî (Share)</h3>
                                        <div className="h-[250px] w-full relative">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <PieChart>
                                                    <Pie
                                                        data={gbStats}
                                                        cx="50%"
                                                        cy="50%"
                                                        innerRadius={60}
                                                        outerRadius={80}
                                                        paddingAngle={5}
                                                        dataKey="value"
                                                    >
                                                        {gbStats.map((entry, index) => (
                                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                                        ))}
                                                    </Pie>
                                                    <Tooltip />
                                                    <Legend verticalAlign="bottom" height={36}/>
                                                </PieChart>
                                            </ResponsiveContainer>
                                            {/* ‰∏≠ÂøÉÊñáÂ≠ó */}
                                            <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                                <span className="text-2xl font-bold text-slate-700">Total</span>
                                                <span className="text-xs text-slate-400">Orderlines</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 3. ÊòéÁªÜË°®Ê†º (Details Table) */}
                                <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="p-4 border-b border-slate-50 flex flex-col md:flex-row md:items-center justify-between gap-3">
                                        <h3 className="font-bold text-slate-700">‰ªìÂ∫ìËøêËê•ÊòéÁªÜ</h3>
                                        <div className="relative">
                                            <Icons.Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" />
                                            <input 
                                                type="text" 
                                                placeholder="ÊêúÁ¥¢‰ªìÂ∫ìÊàñÂõΩÂÆ∂..." 
                                                value={searchTerm}
                                                onChange={e => setSearchTerm(e.target.value)}
                                                className="pl-9 pr-4 py-1.5 text-sm border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-[#005691] w-full md:w-64 transition-all"
                                            />
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left text-slate-600">
                                            <thead className="bg-slate-50 text-slate-500 font-semibold">
                                                <tr>
                                                    <th className="px-6 py-3">Warehouse</th>
                                                    <th className="px-6 py-3">Country</th>
                                                    <th className="px-6 py-3">GB</th>
                                                    <th className="px-6 py-3 text-right">Inbound</th>
                                                    <th className="px-6 py-3 text-right">Outbound</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {processedData.slice(0, 10).map((row, idx) => (
                                                    <tr key={idx} className="hover:bg-slate-50 transition-colors">
                                                        <td className="px-6 py-3 font-medium text-[#005691]">{row.warehouse}</td>
                                                        <td className="px-6 py-3">{row.country}</td>
                                                        <td className="px-6 py-3">
                                                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${row.gb === 'PT' ? 'bg-blue-50 text-blue-700' : 'bg-slate-100 text-slate-600'}`}>
                                                                {row.gb}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-3 text-right">{row.inbound.toLocaleString()}</td>
                                                        <td className="px-6 py-3 text-right">{row.outbound.toLocaleString()}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {processedData.length === 0 && <div className="p-8 text-center text-slate-400">Êú™ÊâæÂà∞ÂåπÈÖçÊï∞ÊçÆ</div>}
                                    </div>
                                </div>
                            </div>
                        </main>

                        {/* --- AI ‰æßËæπÊ†è (Float / Sidebar) --- */}
                        <div className={`fixed inset-y-0 right-0 w-full md:w-96 bg-white shadow-2xl transform transition-transform duration-300 ease-in-out z-30 flex flex-col ${showAiPanel ? 'translate-x-0' : 'translate-x-full'}`}>
                            {/* Header */}
                            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-[#005691] text-white">
                                <div className="flex items-center gap-2">
                                    <div className="relative">
                                        <Icons.Bot className="w-6 h-6" />
                                        <span className="absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-[#005691]"></span>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-sm">Supply Chain AI</h3>
                                        <p className="text-[10px] opacity-80">Online ‚Ä¢ Intelligent Assistant</p>
                                    </div>
                                </div>
                                <button onClick={() => setShowAiPanel(false)} className="p-1 hover:bg-white/20 rounded"><Icons.X className="w-5 h-5" /></button>
                            </div>

                            {/* Chat Area */}
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 custom-scroll">
                                {messages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${
                                            m.role === 'user' 
                                            ? 'bg-[#005691] text-white rounded-tr-none' 
                                            : 'bg-white text-slate-700 border border-slate-200 rounded-tl-none'
                                        }`}>
                                            <div style={{whiteSpace: 'pre-wrap'}}>{m.content}</div>
                                        </div>
                                    </div>
                                ))}
                                {isTyping && (
                                    <div className="flex justify-start">
                                        <div className="bg-white p-3 rounded-2xl rounded-tl-none border border-slate-200 shadow-sm flex gap-1">
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"></div>
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style={{animationDelay:'0.1s'}}></div>
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style={{animationDelay:'0.2s'}}></div>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* Quick Actions */}
                            <div className="p-3 bg-white border-t border-slate-100 overflow-x-auto whitespace-nowrap custom-scroll gap-2 flex">
                                {QUICK_ACTIONS.map(qa => (
                                    <button 
                                        key={qa.key} 
                                        onClick={() => handleSend(qa.text, qa.key)}
                                        className="px-3 py-1.5 bg-slate-100 hover:bg-blue-50 hover:text-blue-700 text-xs rounded-full border border-slate-200 transition-colors flex items-center gap-1"
                                    >
                                        <Icons.Alert className="w-3 h-3" />
                                        {qa.text}
                                    </button>
                                ))}
                            </div>

                            {/* Input Area */}
                            <div className="p-4 bg-white border-t border-slate-100">
                                <div className="flex gap-2">
                                    <input 
                                        type="text" 
                                        value={inputVal}
                                        onChange={e => setInputVal(e.target.value)}
                                        onKeyPress={e => e.key === 'Enter' && handleSend()}
                                        placeholder="ËæìÂÖ•ÈóÆÈ¢ò (‰æãÂ¶Ç: ÂàÜÊûêÂ∫ìÂ≠òÈ£éÈô©)..."
                                        className="flex-1 border border-slate-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#005691]"
                                    />
                                    <button 
                                        onClick={() => handleSend()}
                                        disabled={isTyping}
                                        className="bg-[#005691] text-white p-2.5 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"
                                    >
                                        <Icons.Send className="w-4 h-4" />
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Floating AI Toggle Button */}
                        {!showAiPanel && (
                            <button 
                                onClick={() => setShowAiPanel(true)}
                                className="fixed bottom-6 right-6 bg-[#005691] text-white p-4 rounded-full shadow-2xl hover:scale-105 transition-transform z-40 pulse-dot flex items-center justify-center"
                            >
                                <Icons.Bot className="w-6 h-6" />
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // React 17 Ê∏≤ÊüìÊñπÂºè (Ëß£ÂÜ≥ Recharts ÂÖºÂÆπÊÄßÈóÆÈ¢ò)
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
